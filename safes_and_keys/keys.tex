\documentclass[pdftex,12pt,a4paper]{article}


\input{/home/boris/Dropbox/Public/tex_general/title_bor_utf8}

%\usepackage{showkeys} % показывать метки

\input{/home/boris/Dropbox/Public/tex_general/prob_and_sol_utf8}

%\title{Задачи по элементарной теории вероятностей и матстатистике}
%\author{Составитель: Борис Демешев, boris.demeshev@gmail.com}
%\date{\today}
\title{Вокруг задачи про ключи и сейфы}
\author{Борис Демешев}

\date{\today}


\begin{document}

\maketitle

\parindent=0 pt % отступ равен 0


\bibliographystyle{plain} % стиль оформления ссылок

\begin{abstract}
Задача про ключи и сейфы, ее решения и вариации на тему.
\end{abstract}



\section{Постановка задачи и первые попытки}
В ряд один за одним стоят 100 сейфов. Закрыть открытый сейф можно без ключа. Достать содержимое закрытого сейфа можно только открыв его ключом. К каждому сейфу подходит ровно один ключ. 

Мы раскладываем ключи по сейфам наугад, один ключ в один сейф. Затем закрываем все сейфы кроме первых двух. А затем пытаемся открыть все сейфы.

Какова вероятность того, что мы сможем это сделать? \hyperref[lojniiseif]{Туда!}

Вперед! Два открытых сейфа сразу дают нам два ключа. Этими ключами можно открыть два новых сейфа... Хотя нет, необязательно, один или оба ключа могут быть от уже раскрытых сейфов. Значит с начала три варианта: два полезных ключа, один полезный, ни одного полезного. Дальше число вариантов быстро возрастает. С налету задача не решилась, видно, что дерево возможных исходов слишком ветвистое. \cite{aops:keys}

% Здесь нужно посадить дерево!

Что ж! Попробуем решить похожую задачу, но попроще. Что будет если закрывать все сейфы кроме первого? Шансы, что первый ключ будет полезным равны $\frac{99}{100}$. Если первый добытый ключ полезный, то теперь у нас 99 сейфов и один открыт. Значит условная вероятность получить второй полезный ключ (при условии, что первый полезный) равна $\frac{98}{99}$. Продолжаем и получаем, что:
$$ 
p_{1,100}=\frac{99}{100}\cdot\frac{98}{99}\cdot...\cdot\frac{1}{2}=\frac{1}{100}
$$
Попробуем еще одну упрощенную версию. Что будет если закрыть только последний сейф? Единственная ситуация, когда мы не сможем его открыть, если ключ от него оказался в нем самом. Вероятность такого <<запертого>> ключа равна $\frac{1}{100}$. Значит, вероятность успеха равна $\frac{99}{100}$.

Уже неплохо! Попробуем рассмотреть совсем крайние случаи! Если изначально не открыт ни один сейф, то $p_{0,100}=0$, а если открыты все, то $p_{100,100}=1$. 

Возникает смутная догадка, а вдруг $p_{k,n}=\frac{k}{n}$? Пробуем проверить догадку на еще одном простом примере - всего 4 сейфа, из которых закрывают 2. Всего вариантов распределения ключей $4!$. Тупиковыми оказываются три типа расположения ключей. Во-первых, ситуации, где третий сейф содержит ключ от самого себя, таких ситуаций будет $3!$. Во-вторых, ситуации, где четвертый сейф содержит ключ от самого себя, таких ситуаций будет $3!$, из них 2 совпадают с теми, где заперт ключ от третьего сейфа.
И в-третьих, ситуации, где третий содержит ключ от четвертого, а четвертый - от третьего, таких ситуаций две. Значит вероятность открыть все сейфы равна: 
$$
p_{2,4}=\frac{4!-(3!+3!-2!)-2!}{4!}=\frac{1}{2}
$$
Укрепившись в нашей догадке мы готовы бороться за решение. Искать решение задачи проще, если знаешь ответ!

\section{Метод первого шага}
Разобьем одну копилку и проследим за судьбой извлеченного ключа. С
вероятностью $\frac{k}{n}$ ключ не дает ничего нового, так как
предназначен для копилки, которую мы и так разобьем, а с
вероятностью $\frac{n-k}{n}$ <<разбивает>>
еще одну копилку. \\
Получаем уравнение: $p(k,n)=\frac{k}{n}p(k-1,n-1)+\frac{n-k}{n}p(k,n-1)$. \\
С очевидными краевыми условиями $p(n,n)=1$, $p(0,n)=0$. \\
Угадываем решение, $p(k,n)=\frac{k}{n}$. \\

Данный метод позволяет также получить ответ на вопрос:
Сколько в среднем можно добыть ключей? Или: сколько сейфов в среднем окажутся в итоге открытыми?

По аналогии с нахождением вероятности получаем уравнение: \\
$e(k,n)=1+\frac{k}{n}e(k-1,n-1)+\frac{n-k}{n}e(k,n-1)$. \\
Граничные условия на этот раз имеют вид: $e(n,n)=n$, $e(0,n)=0$ \\
После экспериментов с мелкими $k$ и $n$ можно попробовать $\frac{k(n+1)}{k+1}$. \\

\section{Метод разложения в сумму}

Для нахождения математического ожидания в каком-нибудь непростом случае часто помогает очень простое свойство $E(X+Y)=E(X)+E(Y)$. 

?????

\phantomsection
Добавим в наши ряды <<ложный сейф>>. \label{lojniiseif} Расположим их в ??? круг. Открытыми сейфами круг разбит на $k+1$ часть. Средняя длина каждой $\frac{n+1}{k+1}$. Из них открывается $k$. Бред полный, но додумать наверняка можно!!!



????

Какова ожидаемая доля разбитых копилок? \\
Какова вероятность получить конкретный ключ, если разбивать $k$ копилок наугад? \\
Какова вероятность получить содержимое конкретной копилки, если разбивать $k$ копилок наугад? \\

Ожидаемая доля вскрытых копилок легко получается из среднего
количества вскрытых копилок, $\frac{k(n+1)}{n(k+1)}$. \\
Вероятность, также равна этому числу. Если $X_{i}$ - индикатор
того, взят ли $i$-ый ключ, то вероятность получить отдельный ключ
равна $P(X_{i}=1)=E(X_{i})$, а cреднее количество добытых ключей
равно $E(X_{1}+X_{2}+...+X_{n})=nP(X_{i}=1)$.
Следовательно, искомая вероятность равна $\frac{k(n+1)}{n(k+1)}$. \\





\section{Комбинаторика и группа перестановок}
Что происходит, если начать с одного открытого сейфа? Достаем новый ключ. Открываем новый сейф. Снова достаем новый ключ... Рано или поздно добытый ключ окажется бесполезным и будет вести в уже открытый сейф. Точнее (и это важно!) в изначальный! Почему? Иначе оказалось бы, что к некоторому сейфу подходит два ключа: тот, которым он был открыт в первый раз, и первый бесполезный ключ. Получается, что ключи добываются <<циклами>>.

Есть еще одна формулировка этого факта. События <<получен ключ от $i$-ого сейфа>> и <<получено содержимое $i$-ого сейфа>> совпадают. Казалось бы, только из первого следует второе. Ведь первые $k$ сейфов изначально открыты. Однако каждый цикл ключей получается
целиком, поэтому если $i$-ый сейф копилка была открыт изначально, то
получение ключей окончится только если будет получен ключ от
$i$-ого сейфа. \\


Имеется $n!$ способов разложить ключи по копилкам. \\
Есть $(n-1)!$ способов разложить ключи по копилкам так, чтобы был
ровно один цикл. \\
Зафиксируем открываемые $k$ копилок. Оказывается, что число
способов разложить ключи так, чтобы образовывалось $s$ вскрываемых
циклов, также равно $(n-1)!$. Можно обойтись без громоздких сумм с
биномиальными коэффициентами. Заметим, что $s\le k$. \\
Среди $k$ открываемых копилок выберем $s$ <<граничных>> копилок.
Рассмотрим произвольную раскладку ключей, в которой имеется ровно
один цикл. Граничные копилки <<разбивают>> цикл на $s$ циклов.
Получается взаимно однозначное соответствие между раскладками
ключей, в которых имеется $s$ циклов и раскладками ключей с одним
циклом. Однозначность получается при фиксированных граничных
копилках. \\
Нам подходят те раскладки ключей, в которых образуется от 1 до $k$
вскрываемых циклов. Получаем вероятность, равную
$\frac{k(n-1)!}{n!}$ \\

\section{Перепостановка эксперимента}
Бывает, что вероятность или математическое ожидание легче посчитать, если представить себе другой (но равносильный) случайный эксперимент.

Например, есть такая классическая задача. Тоже, кстати, про ключи! Есть десять ключей. К замку подходит лишь один из них. Мы их пробуем в случайном порядке, не подошедшие откладываем в сторону. Какова вероятность того, что замок откроется десятым ключом?

Людям впервые столкнувшимся с теорией вероятностей ответ $1/10$ часто кажется неправдоподобным. Они говорят: <<Это вероятность для первого ключа! А для десятого она другая, ведь возможно, что мы уже откроем дверь каким-нибудь предыдущим ключом!>>.

Попробуем однако поставить другой эксперимент. Представим, что ключи - это не ключи, а шарики. Представим также, что на земле есть узкая канавка, шириной в один шарик, в которую все шарики скатяться. У канавки также есть направление, скажем, стрелочка рядом нарисована. Один шарик помечен крестиком. Потрясем мешок с шариками, чтобы они все хорошо перемешались, а затем раскроем мешок над нашей канавкой. Шарики покатаются и остановятся, упорядочившись в нашей канавке. Какова вероятность, что самый последний шарик (по стрелочке) - меченый? Очевидно, что она равна $1/10$. Осталось только сказать, что задачи абсолютно идентичны, так как есть взаимно однозначное соответствие между порядком шариков в канавке и порядком опробования ключей. Представьте! Перед тем как мы начали доставать ключи, богиня случая провела эксперимент с шариками, и <<выдает>> нам ключи в том порядке, в каком шарики выстроились в линию.


\section{Теорема об остановке мартингала}
Если $X_{n}$ - мартингал и $T$ - ограниченный сверху момент остановки (т.е. существует число $m$, такое что $T<m$), то $E(X_{T})=E(X_{1})$. 




\section{ <<Золотой ключик>> и новая задача}
Задача решена, и ответ: $p_{k,n}=\frac{k}{n}$. Поставим вопрос наооборот: придумать задачу в которой ответ равен $\frac{k}{n}$!

Это, конечно же, несложно даже не отходя от наших сейфов! Например: положим наугад в один из сейфов <<золотой ключик>>, который открывает все сейфы. Затем, закроем все, кроме $k$ сейфов и попытаемся открыть все сейфы. Удача нас ждет только если нам доступен <<золотой ключик>>! А шансы раздобыть его равны $\frac{k}{n}$.

Значит, если все ключи заменить одним универсальным, то ответ не меняется! Возникает идея еще одного доказательства: а вдруг легко доказать, что при замене нескольких ключей на одну отмычку, открывающую те же сейфы, вероятность не меняется? Если это так, тогда мы по-тихоньку заменеям все ключи на отмычки, до тех пор, пока не останется <<золотой ключик>>. Вероятность в ходе процесса не меняется, а в конце равна $\frac{k}{n}$! 

У меня не получилось простого доказательства этого факта. Он тем не менее верен, как  видно из решения новой задачи: 

На столе стоят 100 копилок.
Достать содержимое копилки можно двумя способами: либо разбить
копилку, либо открыть дно специальным ключиком. К каждой копилке
подходит ровно один ключик. Сначала определенным образом ключи
связываются в несколько связок. Затем мы раскладываем связки
ключей по копилкам наугад, не более одной связки в копилку. Часть
копилок остается пустыми.
Затем разбиваем 2 копилки. \\
Какова вероятность того, что мы сможем достать все ключи? \\

Сведем эту задачу к уже решенной! Вероятность, как ни странно, не зависит от
того, какие конкретно
связки сформированы. И она снова равна $\frac{2}{100}$! \\

Решение получается путем перехода к исходной задаче. \\
Зафиксируем открываемые копилки. Можно обнаружить, что
последовательное удаление ключей, открывающих пустые копилки, не
изменяет ситуации. Если все ключи добывались до удаления
бесполезных ключей, то все ключи добываются и после удаления
бесполезных ключей. И наооборот. \\
После удаления бесполезных ключей остаются пустые копилки и
копилки с одним ключом. А такая ситуация равносильна размещению
<<золотого ключика>>. В результате вероятность снова равна
$\frac{k}{n}$. \\



\section{Напутствие...}
При решении задачи возникали разные гипотезы. Все тупиковые ветви не упомянуты, хотя хотелось бы найти хорошее описание процесса решения задачи. От начала и до конца, со всеми тупиками и ошибками. 
Гипотезы я часто провереля с помощью простой компьютерной программы, случайным образом раскладывавшей ключи. Ее не сложно написать, но я несколько раз попадался на том, что  $n!$ растет слишком быстро! Перебор всех вариантов невозможен. И при рассмотрении случайных перестановок очень важным оказывается способ, которым выбирается <<случайная>> перестановка. \\

Как выглядит ожидаемое количество взятых ключей или вероятность
получить отдельный ключ, когда речь идет о связках ключей мне не
известно. Если также просто, то это будет просто фантастика! \\


Автор задачи мне не известен. Знаю лишь, что задача была
предложена на Тайваньской национальной математической олимпиаде в
начале 2006 года. Позже она активно обсуждалась на разных студенческих форумах в интернете, например миэф, ру-мат, 

<<Задача на пиратскую вероятность>> на форуме факультета математики Волжского Государственного университета 

Активнее всего она обсуждалась на форуме artofproblemsolving. По этому поводу дельный совет, если знаешь английский, то обсуждай любую задачу на самом активном математическом форуме - на artofproblemsolving!


И напоследоак - Вариация на тему...
В здании есть $n$ эвакуационных выходов, из которых открыты $k$
штук. Началась учебная тревога. По учебной тревоге каждый из $n$
сотрудников бежит к своему выходу. Если выход открыт, то сотрудник
выбегает из здания. Если выход закрыт и сотрудник прибежал к этому
выходу первым, то он в панике возвращается вглубь здания, блуждает
по коридорам и выбегает к наугад выбираемому выходу, возможно к
своему же. Если до сотрудника у закрытого выхода кто-то уже был,
то сотрудник бежит по следам предшественника, возможно по своим же. \\
Какова вероятность того, что все сотрудники будут спасены? \\










%На мой взгляд оба решения не объясняют простоту ответа. При таком
%простом ответе хочется чего-то более наглядного. Возникла идея
%<<золотого ключа>>, от которой хотелось еще одного решения, а
%получилась еще одна задача. \\









%Links: \\
%http://www.artofproblemsolving.com/Forum/viewtopic.php?t=80325 \\
%http://mf.volsu.ru/forum/viewtopic.php?t=1679 \\

\bibliography{D:/documents/tex_general/opit} 
% название файла с коллекцией названий статей/книг

\end{document}